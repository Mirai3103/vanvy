<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Point Mapper Tool</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- AlpineJS -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        .wrapper {
            position: relative;
            display: inline-block;
        }
        .point {
            position: absolute;
            width: 10px;
            height: 10px;
            background: red;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body class="bg-gray-50 flex items-center justify-center min-h-screen p-6">

<div x-data="pointTool" class="max-w-3xl w-full space-y-4">

    <!-- Input image URL -->
    <input
        x-model="imageUrl"
        type="text"
        placeholder="Paste image URL here..."
        class="border px-3 py-2 w-full rounded"
    >

    <button @click="loadImage"
            class="bg-blue-600 text-white px-4 py-2 rounded">
        Load Image
    </button>

    <!-- Image + click mapping -->
    <div class="wrapper border rounded overflow-hidden"
         x-show="loaded"
         x-ref="box">

        <img :src="imageUrl"
             x-ref="img"
             class="block select-none cursor-crosshair"
             @load="resizeImage"
             @click="addPoint($event)">

        <!-- Overlay points -->
        <template x-for="(p,i) in points" :key="i">
            <div class="point"
                 :style="`left: ${p.x * displayWidth}px; top: ${p.y * displayHeight}px;`">
            </div>
        </template>

    </div>

    <!-- Output -->
    <textarea
        x-model="generatedHtml"
        class="w-full h-40 border rounded p-2 text-xs font-mono"
        placeholder="Generated code will appear here...">
    </textarea>

    <button @click="copyHtml"
            class="bg-green-600 text-white px-4 py-2 rounded w-full">
        Copy HTML
    </button>
</div>

<script>
document.addEventListener("alpine:init", () => {
    Alpine.data("pointTool", () => ({
        imageUrl: "",
        loaded: false,
        points: [],
        imgWidth: 0,
        imgHeight: 0,
        displayWidth: 0,
        displayHeight: 0,
        generatedHtml: "",

        loadImage() {
            this.loaded = false;
            this.points = [];
            this.generatedHtml = "";

            this.$nextTick(() => {
                let img = new Image();
                img.src = this.imageUrl;
                img.onload = () => {
                    this.imgWidth = img.width;
                    this.imgHeight = img.height;
                    this.loaded = true;
                    this.$nextTick(() => this.resizeImage());
                };
            });
        },

        resizeImage() {
            let rect = this.$refs.img.getBoundingClientRect();
            this.displayWidth = rect.width;
            this.displayHeight = rect.height;
            this.updateRenderedPoints();
        },

        addPoint(e) {
            let rect = this.$refs.img.getBoundingClientRect();
            let x = (e.clientX - rect.left) / rect.width;
            let y = (e.clientY - rect.top) / rect.height;

            // Only accept valid clicks
            if (x < 0 || x > 1 || y < 0 || y > 1) return;

            this.points.push({ x, y });
            this.refreshHtml();
            this.updateRenderedPoints();
        },

        updateRenderedPoints() {
            // Force refresh display positions
            this.$nextTick(() => {});
        },

        refreshHtml() {
            let html = `<div class="wrapper">\n    <img id="img" src="${this.imageUrl}">\n`;
            this.points.forEach(p => {
                html += `    <div class="point" data-x="${p.x.toFixed(4)}" data-y="${p.y.toFixed(4)}"></div>\n`;
            });
            html += `</div>`;
            this.generatedHtml = html;
        },

        copyHtml() {
            navigator.clipboard.writeText(this.generatedHtml);
            alert("HTML copied!");
        }
    }));
});
</script>

</body>
</html>
